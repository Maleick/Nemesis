---
phase: 09-ai-governance-cost-controls
plan: 02
type: execute
wave: 2
depends_on:
  - "09-01"
files_modified:
  - projects/web_api/web_api/main.py
  - projects/web_api/web_api/models/responses.py
  - projects/web_api/tests/test_workflow_observability.py
  - projects/web_api/tests/test_ai_governance_summary.py
  - projects/frontend/src/components/Dashboard/StatsOverview.jsx
  - projects/frontend/src/components/Help/HelpPage.jsx
  - tools/test.sh
  - tools/tests/test_ai_governance_contracts.sh
  - docs/agents.md
  - docs/usage_guide.md
  - docs/troubleshooting.md
files-modified: [projects/web_api/web_api/main.py, projects/web_api/web_api/models/responses.py, projects/web_api/tests/test_workflow_observability.py, projects/web_api/tests/test_ai_governance_summary.py, projects/frontend/src/components/Dashboard/StatsOverview.jsx, projects/frontend/src/components/Help/HelpPage.jsx, tools/test.sh, tools/tests/test_ai_governance_contracts.sh, docs/agents.md, docs/usage_guide.md, docs/troubleshooting.md]
autonomous: true
objective: "Expose budget-oriented AI usage/cost governance signals in operational summary surfaces with deterministic fail-safe and runbook/test contracts."
requirements:
  - AI-02
user_setup: []
must_haves:
  truths:
    - "Operators can see AI usage/cost governance state (including budget warning/critical status) in the same operational summary flow used for queue/failure/service triage."
    - "AI governance summary remains fail-safe when spend or auth dependencies are unavailable, emitting degraded metadata instead of opaque failure."
    - "Docs and deterministic gate scripts keep API/UI/runbook contract terms aligned and regression-detectable."
  artifacts:
    - path: "projects/web_api/web_api/main.py"
      provides: "observability payload assembly that includes ai_governance signal block with severity and fallback context"
    - path: "projects/web_api/web_api/models/responses.py"
      provides: "typed ai_governance signal models embedded in observability summary contracts"
    - path: "projects/web_api/tests/test_ai_governance_summary.py"
      provides: "regression coverage for budget severity thresholds and dependency-failure fallback behavior"
      min_lines: 90
    - path: "projects/frontend/src/components/Dashboard/StatsOverview.jsx"
      provides: "operator-visible AI governance summary card(s) with triage links"
    - path: "tools/tests/test_ai_governance_contracts.sh"
      provides: "deterministic contract gate for AI governance docs/CLI/API terminology and wiring"
      min_lines: 60
    - path: "tools/test.sh"
      provides: "standardized --ai-governance-contract wrapper for local and CI execution parity"
    - path: "docs/usage_guide.md"
      provides: "AI governance triage sequence and evidence checklist"
    - path: "docs/troubleshooting.md"
      provides: "incident response flow and rollback guidance for AI budget/policy regressions"
  key_links:
    - from: "projects/web_api/web_api/main.py"
      to: "projects/web_api/web_api/models/responses.py"
      via: "observability summary route returns typed ai_governance contract payload"
    - from: "projects/frontend/src/components/Dashboard/StatsOverview.jsx"
      to: "projects/web_api/web_api/main.py"
      via: "dashboard fetch/render uses ai_governance block from observability summary endpoint"
    - from: "tools/tests/test_ai_governance_contracts.sh"
      to: "docs/usage_guide.md"
      via: "gate script verifies runbook and contract phrases stay aligned with implementation"
    - from: "tools/test.sh"
      to: "tools/tests/test_ai_governance_contracts.sh"
      via: "single-command contract gate path for CI/local validation"
---

<objective>
Expose budget-oriented AI usage/cost governance signals in operational summary surfaces with deterministic fail-safe and runbook/test contracts.

Purpose: satisfy AI-02 by making cost governance visible and actionable in the same operational surfaces used for incident triage.
Output: ai_governance summary contract + dashboard visibility + docs/test gate alignment.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/09-ai-governance-cost-controls/09-RESEARCH.md
@.planning/phases/09-ai-governance-cost-controls/09-01-PLAN.md
@projects/web_api/web_api/main.py
@projects/web_api/web_api/models/responses.py
@projects/web_api/tests/test_workflow_observability.py
@projects/frontend/src/components/Dashboard/StatsOverview.jsx
@projects/frontend/src/components/Help/HelpPage.jsx
@tools/test.sh
@docs/agents.md
@docs/usage_guide.md
@docs/troubleshooting.md
</context>

<tasks>

## Task 1
<task type="auto">
  <name>Task 1: Add AI governance budget signal to observability summary contract</name>
  <files>projects/web_api/web_api/main.py, projects/web_api/web_api/models/responses.py, projects/web_api/tests/test_workflow_observability.py, projects/web_api/tests/test_ai_governance_summary.py</files>
  <action>Extend observability summary assembly with an `ai_governance` block sourced from spend/auth data, including budget thresholds, utilization ratio, severity classification, and fail-safe dependency metadata when telemetry is unavailable.</action>
  <verify>cd /opt/Nemesis/projects/web_api && uv run pytest tests/test_workflow_observability.py tests/test_ai_governance_summary.py -q</verify>
  <done>Operational summary payload includes typed AI usage/cost governance state with deterministic warning/critical/fail-safe behavior.</done>
</task>

## Task 2
<task type="auto">
  <name>Task 2: Surface AI governance signals in dashboard/help triage paths</name>
  <files>projects/frontend/src/components/Dashboard/StatsOverview.jsx, projects/frontend/src/components/Help/HelpPage.jsx</files>
  <action>Render AI governance severity and key budget metrics in dashboard operational cards and add/align triage links so operators can immediately pivot to governance runbooks when spend/auth risk states degrade.</action>
  <verify>cd /opt/Nemesis/projects/frontend && npm run test:smoke && npm run build && cd /opt/Nemesis && rg -n "AI governance|budget|spend|triage" projects/frontend/src/components/Dashboard/StatsOverview.jsx projects/frontend/src/components/Help/HelpPage.jsx</verify>
  <done>Operators can observe and triage AI cost-governance state directly from operational dashboard/help surfaces.</done>
</task>

## Task 3
<task type="auto">
  <name>Task 3: Add deterministic AI governance contract gate and aligned runbooks</name>
  <files>tools/tests/test_ai_governance_contracts.sh, tools/test.sh, docs/agents.md, docs/usage_guide.md, docs/troubleshooting.md</files>
  <action>Create a deterministic shell gate for AI governance contract terms and wire it into `tools/test.sh --ai-governance-contract`; update docs with a unified evidence/rollback runbook for spend warning states and dependency-failure fallback interpretation.</action>
  <verify>cd /opt/Nemesis && bash tools/tests/test_ai_governance_contracts.sh && ./tools/test.sh --ai-governance-contract && rg -n "ai governance|budget|spend|warning|critical|rollback" docs/agents.md docs/usage_guide.md docs/troubleshooting.md</verify>
  <done>AI governance API/UI/docs behavior is contract-locked by a repeatable local/CI gate.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd /opt/Nemesis/projects/web_api && uv run pytest tests/test_workflow_observability.py tests/test_ai_governance_summary.py -q` passes
- [ ] `cd /opt/Nemesis/projects/frontend && npm run test:smoke && npm run build` passes
- [ ] `cd /opt/Nemesis && bash tools/tests/test_ai_governance_contracts.sh && ./tools/test.sh --ai-governance-contract` passes
- [ ] `cd /opt/Nemesis && rg -n "ai_governance|budget|spend|severity|fail_safe" projects/web_api/web_api/main.py projects/web_api/web_api/models/responses.py projects/frontend/src/components/Dashboard/StatsOverview.jsx` confirms contract wiring
- [ ] AI-02 evidence recorded: budget-oriented AI governance signals are visible in operational summary surfaces
</verification>

<success_criteria>

- AI-02 is satisfied with explicit AI usage/cost governance visibility in observability and operator dashboards
- Dependency failure produces clear degraded/fail-safe governance metadata rather than opaque breakage
- Docs and deterministic contract gates prevent drift between API behavior, operator workflow, and triage guidance

</success_criteria>

<output>
After completion, create `.planning/phases/09-ai-governance-cost-controls/09-02-SUMMARY.md`
</output>
