---
phase: 01-service-health-contracts
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - libs/common/common/health_contract.py
  - libs/common/common/logger.py
  - libs/common/common/models2/health.py
  - projects/web_api/tests/test_health_contract.py
autonomous: true
requirements:
  - RELI-01
  - RELI-04
user_setup: []
must_haves:
  truths:
    - "Core services share one readiness contract shape for health reporting"
    - "Health failures include dependency-level remediation context"
  artifacts:
    - path: "libs/common/common/health_contract.py"
      provides: "shared readiness contract helpers"
      min_lines: 40
    - path: "libs/common/common/models2/health.py"
      provides: "typed health response schema"
    - path: "projects/web_api/tests/test_health_contract.py"
      provides: "contract behavior tests"
  key_links:
    - from: "libs/common/common/health_contract.py"
      to: "libs/common/common/models2/health.py"
      via: "shared response typing"
---

<objective>
Define and scaffold a shared service-health/readiness contract that core services can adopt without breaking current endpoint compatibility.

Purpose: create a single source of truth for readiness semantics before touching service-specific implementations.
Output: shared health contract module, typed schema support, and baseline tests.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-service-health-contracts/01-CONTEXT.md
@.planning/phases/01-service-health-contracts/01-RESEARCH.md
@libs/common/common/logger.py
@projects/web_api/web_api/main.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared readiness contract module</name>
  <files>libs/common/common/health_contract.py, libs/common/common/models2/health.py</files>
  <action>Implement typed helpers that represent healthy/degraded/unhealthy readiness with dependency details and remediation hints. Preserve backward compatibility by supporting minimal status-only rendering when consumers do not yet opt into full payload.</action>
  <verify>uv run pytest projects/web_api/tests/test_health_contract.py -q</verify>
  <done>Shared contract helpers and typed schemas exist with tests passing</done>
</task>

<task type="auto">
  <name>Task 2: Integrate contract-aware logging helpers</name>
  <files>libs/common/common/logger.py, libs/common/common/health_contract.py</files>
  <action>Add secret-safe structured logging helpers for health dependency failures and remediation hints; explicitly avoid logging sensitive values.</action>
  <verify>rg -n "secret|password|token" libs/common/common/health_contract.py libs/common/common/logger.py</verify>
  <done>Readiness logging emits actionable, secret-safe context</done>
</task>

<task type="auto">
  <name>Task 3: Add baseline contract tests</name>
  <files>projects/web_api/tests/test_health_contract.py</files>
  <action>Cover core contract scenarios: all dependencies healthy, one dependency unhealthy, and degraded mode with remediation hints.</action>
  <verify>uv run pytest projects/web_api/tests/test_health_contract.py -q</verify>
  <done>Contract tests validate expected readiness behavior</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `uv run pytest projects/web_api/tests/test_health_contract.py -q` passes
- [ ] New helper modules are imported without circular dependency issues
- [ ] No secret-bearing values are introduced in readiness logging paths
</verification>

<success_criteria>

- Shared readiness contract module exists and is reusable
- Contract tests validate healthy/degraded/unhealthy patterns
- Logging guidance for dependency failures is explicit and secret-safe

</success_criteria>

<output>
After completion, create `.planning/phases/01-service-health-contracts/01-01-SUMMARY.md`
</output>
