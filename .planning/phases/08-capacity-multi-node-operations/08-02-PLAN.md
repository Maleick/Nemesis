---
phase: 08-capacity-multi-node-operations
plan: 02
type: execute
wave: 2
depends_on:
  - "08-01"
files_modified:
  - docs/docker_compose.md
  - docs/performance.md
  - docs/troubleshooting.md
  - docs/quickstart.md
  - tools/tests/test_capacity_profile_contracts.sh
  - .github/workflows/ci-fast.yml
files-modified: [docs/docker_compose.md, docs/performance.md, docs/troubleshooting.md, docs/quickstart.md, tools/tests/test_capacity_profile_contracts.sh, .github/workflows/ci-fast.yml]
autonomous: true
objective: "Publish executable multi-node capacity runbooks and enforce documentation/runtime alignment in CI."
requirements:
  - SCALE-03
user_setup: []
must_haves:
  truths:
    - "Operators can follow one documented multi-node capacity runbook (startup, readiness validation, evidence collection, rollback) without undocumented steps."
    - "Capacity profile guidance across quickstart, compose docs, troubleshooting, and performance docs is consistent with current compose/runtime behavior."
    - "Runbook drift is prevented by deterministic contract checks executed in CI."
  artifacts:
    - path: "docs/docker_compose.md"
      provides: "canonical multi-node profile matrix and scale-out runbook"
      min_lines: 180
    - path: "docs/performance.md"
      provides: "capacity evidence and queue-drain interpretation aligned with profile runbook"
    - path: "docs/troubleshooting.md"
      provides: "capacity incident triage and rollback sequence aligned with runbook"
    - path: "docs/quickstart.md"
      provides: "quickstart pointer and validation path for capacity profiles"
    - path: "tools/tests/test_capacity_profile_contracts.sh"
      provides: "doc contract assertions for runbook terms and command parity"
    - path: ".github/workflows/ci-fast.yml"
      provides: "CI execution of capacity contract gate"
  key_links:
    - from: "docs/docker_compose.md"
      to: "tools/nemesis-ctl.sh"
      via: "runbook commands reference the canonical operator command surface"
    - from: "tools/tests/test_capacity_profile_contracts.sh"
      to: "docs/docker_compose.md"
      via: "capacity runbook terms and commands are validated by deterministic checks"
    - from: ".github/workflows/ci-fast.yml"
      to: "tools/tests/test_capacity_profile_contracts.sh"
      via: "CI gate executes capacity contract checks on every PR"
    - from: "docs/performance.md"
      to: "docs/troubleshooting.md"
      via: "evidence and rollback guidance stays aligned for steady-state and incident flows"
---

<objective>
Publish executable multi-node capacity runbooks and enforce documentation/runtime alignment in CI.

Purpose: satisfy SCALE-03 by turning existing compose scale primitives into operator-safe, reproducible runbooks with automated drift prevention.
Output: aligned docs + deterministic contract gate + CI wiring.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/08-capacity-multi-node-operations/08-RESEARCH.md
@.planning/phases/08-capacity-multi-node-operations/08-01-PLAN.md
@docs/docker_compose.md
@docs/performance.md
@docs/troubleshooting.md
@docs/quickstart.md
@tools/tests/test_capacity_profile_contracts.sh
@.github/workflows/ci-fast.yml
@compose.yaml
@compose.prod.build.yaml
</context>

<tasks>

## Task 1
<task type="auto">
  <name>Task 1: Create canonical multi-node capacity runbook and profile matrix</name>
  <files>docs/docker_compose.md</files>
  <action>Add a deterministic capacity profile matrix and step-by-step multi-node runbook that covers baseline startup, observability profile enablement, file-enrichment replica activation, profile-consistent readiness checks, and explicit rollback commands.</action>
  <verify>cd /opt/Nemesis && rg -n "capacity profile|multi-node|scale-out|file-enrichment-1|validate readiness|rollback" docs/docker_compose.md</verify>
  <done>`docs/docker_compose.md` provides one executable path for multi-node capacity operations without undocumented steps.</done>
</task>

## Task 2
<task type="auto">
  <name>Task 2: Align quickstart, performance, and troubleshooting guidance to the same capacity contract</name>
  <files>docs/performance.md, docs/troubleshooting.md, docs/quickstart.md</files>
  <action>Update supporting docs so capacity profile sequencing, queue-drain evidence collection, and rollback triggers/revert commands match the canonical runbook and current compose/runtime behavior.</action>
  <verify>cd /opt/Nemesis && rg -n "capacity profile|multi-node|queue-drain|status|rollback|revert" docs/performance.md docs/troubleshooting.md docs/quickstart.md</verify>
  <done>All operator-facing docs describe the same capacity profile workflow and evidence/rollback rules.</done>
</task>

## Task 3
<task type="auto">
  <name>Task 3: Enforce runbook drift prevention in deterministic gates and CI</name>
  <files>tools/tests/test_capacity_profile_contracts.sh, .github/workflows/ci-fast.yml</files>
  <action>Extend capacity contract assertions for new runbook language and wire the capacity contract gate into the fast CI workflow so doc/runtime drift is blocked before merge.</action>
  <verify>cd /opt/Nemesis && bash tools/tests/test_capacity_profile_contracts.sh && rg -n "capacity contract|test_capacity_profile_contracts" .github/workflows/ci-fast.yml</verify>
  <done>Capacity runbook alignment is validated automatically in local and CI execution paths.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd /opt/Nemesis && bash tools/tests/test_capacity_profile_contracts.sh` passes
- [ ] `cd /opt/Nemesis && rg -n "capacity profile|multi-node|scale-out|rollback|validate readiness|queue-drain" docs/docker_compose.md docs/performance.md docs/troubleshooting.md docs/quickstart.md` confirms runbook coverage
- [ ] `cd /opt/Nemesis && rg -n "test_capacity_profile_contracts|capacity contract" .github/workflows/ci-fast.yml tools/test.sh` confirms CI + local gate wiring
- [ ] SCALE-03 evidence recorded: operators can deploy and validate multi-node capacity profiles with deterministic docs/tests
</verification>

<success_criteria>

- SCALE-03 is satisfied through executable, profile-aware multi-node runbooks
- Capacity guidance across docs stays aligned with compose/runtime behavior
- Drift prevention is enforced by deterministic capacity gates in CI

</success_criteria>

<output>
After completion, create `.planning/phases/08-capacity-multi-node-operations/08-02-SUMMARY.md`
</output>
